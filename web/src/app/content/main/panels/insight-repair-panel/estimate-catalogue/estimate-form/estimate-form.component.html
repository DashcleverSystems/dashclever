<app-dialog>
  <div class="header" modal-header>
    <div class="title">
      {{ 'components.estimateCatalogue.form.title' | translate }}
    </div>
  </div>
  <div modal-content [formGroup]="form">
    <div class="content">
      <div class="section">
        <div class="controls-container">
          @if (form.controls.estimateName; as control) {
            <div class="control">
              <label htmlFor="field-estimateId">{{
                'components.estimateCatalogue.form.estimateId' | translate
              }}</label>
              <input
                pInputText
                id="field-estimateName"
                type="text"
                aria-describedby="estimateName-help"
                formControlName="estimateName"
              />
              <input
                pInputText
                id="field-reportId"
                type="hidden"
                aria-describedby="reportId-help"
                formControlName="reportId"
              />
              <app-form-control-error-output
                [control]="control"
              ></app-form-control-error-output>
            </div>
          }
        </div>
        <div class="controls-container">
          <div class="control">
            <label htmlFor="field-customerName">{{
              'components.estimateCatalogue.form.customerName' | translate
            }}</label>
            <input
              pInputText
              id="field-customerName"
              type="text"
              aria-describedby="customerName-help"
              formControlName="customerName"
            />
          </div>
          <div class="control">
            <label htmlFor="field-startDate">{{
              'components.estimateCatalogue.form.startDate' | translate
            }}</label>
            <input
              pInputText
              id="field-startDate"
              type="date"
              aria-describedby="startDate-help"
              formControlName="startDate"
            />
          </div>
        </div>
        <ng-container formGroupName="vehicleInfo">
          <div class="title">
            {{ 'components.estimateCatalogue.form.vehicleInfo' | translate }}
          </div>
          <div class="controls-container">
            <div class="control">
              <label htmlFor="field-registration">{{
                'components.estimateCatalogue.form.registration' | translate
              }}</label>
              <input
                pInputText
                id="field-registration"
                type="text"
                aria-describedby="registration-help"
                formControlName="registration"
              />
              <app-form-control-error-output
                [control]="form.controls.vehicleInfo.controls.registration"
              ></app-form-control-error-output>
            </div>
            <div class="control">
              <label htmlFor="field-brand">{{
                'components.estimateCatalogue.form.brand' | translate
              }}</label>
              <input
                pInputText
                id="field-brand"
                type="text"
                aria-describedby="brand-help"
                formControlName="brand"
              />
              <app-form-control-error-output
                [control]="form.controls.vehicleInfo.controls.brand"
              ></app-form-control-error-output>
            </div>
          </div>
          <div class="controls-container">
            <div class="control">
              <label htmlFor="field-model">{{
                'components.estimateCatalogue.form.model' | translate
              }}</label>
              <input
                pInputText
                id="field-model"
                type="text"
                aria-describedby="model-help"
                formControlName="model"
              />
              <app-form-control-error-output
                [control]="form.controls.vehicleInfo.controls.model"
              ></app-form-control-error-output>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="section">
        <ng-container formGroupName="paintInfo">
          <div class="title">
            {{ 'components.estimateCatalogue.form.paintInfo' | translate }}
          </div>
          <div class="controls-container">
            <div class="control">
              <label htmlFor="field-baseColorWithCode">{{
                'components.estimateCatalogue.form.baseColorWithCode'
                  | translate
              }}</label>
              <input
                pInputText
                id="field-baseColorWithCode"
                type="text"
                aria-describedby="baseColorWithCode-help"
                formControlName="baseColorWithCode"
              />
              <app-form-control-error-output
                [control]="form.controls.paintInfo.controls.baseColorWithCode"
              ></app-form-control-error-output>
            </div>
            <div class="control">
              <label htmlFor="field-varnishingPaintInfo">{{
                'components.estimateCatalogue.form.varnishingPaintInfo'
                  | translate
              }}</label>
              <input
                pInputText
                id="field-varnishingPaintInfo"
                type="text"
                aria-describedby="varnishingPaintInfo-help"
                formControlName="varnishingPaintInfo"
              />
              <app-form-control-error-output
                [control]="form.controls.paintInfo.controls.varnishingPaintInfo"
              ></app-form-control-error-output>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="section">
        <div class="title">
          {{ 'components.estimateCatalogue.form.jobs' | translate }}
          <button
            pButton
            [pTooltip]="
              'components.estimateCatalogue.form.actions.add' | translate
            "
            (click)="addJob()"
          >
            <i class="pi pi-plus"></i>
          </button>
        </div>
        @for (job of form.controls.jobs.controls; track job; let i = $index) {
          <div class="section">
            <div class="action">
              @if (form.controls.jobs.length > 1) {
                <button
                  pButton
                  (click)="removeJob(i)"
                  [pTooltip]="
                    'components.estimateCatalogue.form.actions.remove'
                      | translate
                  "
                >
                  <i class="pi pi-times"></i>
                </button>
              }
            </div>
            <ng-container [formGroup]="job">
              <div class="controls-container">
                <div class="control">
                  <label htmlFor="field-name">{{
                    'components.estimateCatalogue.form.name' | translate
                  }}</label>
                  <input
                    pInputText
                    id="field-name"
                    type="text"
                    aria-describedby="name-help"
                    formControlName="name"
                  />
                  <app-form-control-error-output
                    [control]="job.controls.name"
                  />
                </div>
                <div class="control">
                  <label htmlFor="manMinutes">{{
                    'components.estimateCatalogue.form.manMinutes' | translate
                  }}</label>
                  <p-inputNumber
                    id="field-manMinutes"
                    aria-describedby="manMinutes-help"
                    formControlName="manMinutes"
                  ></p-inputNumber>
                  <app-form-control-error-output
                    [control]="job.controls.manMinutes"
                  />
                </div>
              </div>
              <ng-container formGroupName="worth">
                <div class="controls-container">
                  <div class="control">
                    <label htmlFor="field-denomination">{{
                      'components.estimateCatalogue.form.worth' | translate
                    }}</label>
                    <p-inputNumber
                      id="field-denomination"
                      aria-describedby="denomination-help"
                      formControlName="denomination"
                      [minFractionDigits]="2"
                    ></p-inputNumber>
                    <app-form-control-error-output
                      [control]="job.controls.worth.controls.denomination"
                    />
                  </div>
                  <div class="control">
                    <label htmlFor="field-currency">{{
                      'components.estimateCatalogue.form.currency' | translate
                    }}</label>
                    <p-dropdown
                      appendTo="body"
                      [options]="dictionaries.currencies"
                      id="field-currency"
                      aria-describedby="currency-help"
                      formControlName="currency"
                      optionLabel="value"
                      optionValue="id"
                      class="w-full"
                    >
                      <ng-template pTemplate="selectedItem" let-currency>
                        <div class="flex align-items-center gap-2">
                          <div [translate]="currency.value"></div>
                        </div>
                      </ng-template>
                      <ng-template let-currency pTemplate="item">
                        <div class="flex align-items-center gap-2">
                          <div [translate]="currency.value"></div>
                        </div>
                      </ng-template>
                    </p-dropdown>
                  </div>
                </div>
              </ng-container>
              <div class="controls-container">
                <div class="control">
                  <label htmlFor="field-jobType" class="pi-required">{{
                    'components.estimateCatalogue.form.jobType' | translate
                  }}</label>
                  <p-dropdown
                    appendTo="body"
                    [options]="dictionaries.jobTypes"
                    id="field-jobType"
                    aria-describedby="jobType-help"
                    formControlName="jobType"
                    optionLabel="value"
                    optionValue="id"
                    class="w-full"
                  >
                    <ng-template pTemplate="selectedItem" let-jobType>
                      <div class="flex align-items-center gap-2">
                        <div [translate]="jobType.value"></div>
                      </div>
                    </ng-template>
                    <ng-template let-jobType pTemplate="item">
                      <div class="flex align-items-center gap-2">
                        <div [translate]="jobType.value"></div>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </div>
              </div>
            </ng-container>
          </div>
        }
      </div>
    </div>
  </div>
  <div class="footer" modal-footer>
    <div class="actions">
      <app-spinner [enable]="loadingSpinner">
        @if (getReportingId) {
          <button class="report-button"
          pButton
          type="button"
          (click)="openModalForm(getReportingId())"
          translate="components.estimateCatalogue.form.actions.report"
          ></button>
        }
        <button
          pButton
          type="submit"
          (click)="submitForm()"
          translate="components.estimateCatalogue.form.actions.save"
        ></button>
      </app-spinner>
    </div>
  </div>
</app-dialog>
